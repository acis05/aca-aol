<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ACA-AOL App</title>
  <style>
    body{ font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; padding:24px; background:#fff7ed; }
    .card{ background:#fff; border:1px solid rgba(0,0,0,.08); border-radius:16px; padding:18px; max-width:860px; margin:0 auto; }
    h1{ margin:0 0 10px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn{
      border:0; cursor:pointer; border-radius:12px; padding:10px 12px;
      background:#f97316; color:#fff; font-weight:700;
    }
    .btn.secondary{ background:#111827; }
    .btn.ghost{ background:#fff; color:#111827; border:1px solid rgba(0,0,0,.12); }
    a{ color:#111827; }
    .muted{ color:#6b7280; font-size:14px; }
    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:14px; }
    @media (max-width:720px){ .grid{ grid-template-columns:1fr; } }
    .box{ border:1px solid rgba(0,0,0,.10); border-radius:14px; padding:12px; background:#fff; }
    .msg{ margin-top:10px; font-size:14px; min-height:18px; }
    .ok{ color:#166534; }
    .err{ color:#991b1b; }
    code{ background:#f3f4f6; padding:2px 6px; border-radius:8px; }
  </style>
</head>

<body>
  <div class="card">
    <h1>✅ Aplikasi ACA-AOL</h1>
    <div class="muted">
      Jika kamu melihat halaman ini, berarti <b>access code + session</b> sudah aktif.
    </div>

    <div class="row">
      <button class="btn" id="btnCheck">Cek Status</button>
      <a class="btn ghost" href="/" style="text-decoration:none; display:inline-flex; align-items:center;">Kembali ke Landing Page</a>
      <button class="btn secondary" id="btnLogout">Logout</button>
    </div>

    <div id="msg" class="msg"></div>

    <div class="grid">
      <div class="box">
        <b>Testing Endpoint</b>
        <div class="muted" style="margin-top:6px;">
          - <a href="/auth/status" target="_blank">/auth/status</a><br/>
          - <a href="/health" target="_blank">/health</a>
        </div>
      </div>

      <div class="box">
        <b>Template Excel</b>
        <div class="muted" style="margin-top:6px;">
          - <a href="/templates/journal-voucher.xlsx" target="_blank">Journal Voucher</a><br/>
          - <a href="/templates/sales-invoice.xlsx" target="_blank">Sales Invoice</a><br/>
          - <a href="/templates/sales-receipt.xlsx" target="_blank">Sales Receipt</a>
        </div>
      </div>
    </div>

    <div class="box" style="margin-top:12px;">
      <b>Catatan penting</b>
      <div class="muted" style="margin-top:6px;">
        Kalau di landing page sudah tertulis “Berhasil! Akses sudah aktif”, tapi tidak masuk app,
        berarti yang kurang hanya <b>redirect</b> ke <code>/app</code> (sudah difix di index.html).
      </div>
    </div>
  </div>

  <script>
    const msg = document.getElementById("msg");

    function setMsg(text, type){
      msg.textContent = text || "";
      msg.className = "msg " + (type || "");
    }

    async function check(){
      try{
        const res = await fetch("/auth/status", { credentials:"include" });
        const data = await res.json();
        if(data.access_ok){
          setMsg("Status OK ✅ access_ok=true, tenant=" + data.tenant + ", host=" + (data.host || ""), "ok");
        }else{
          setMsg("Belum akses ❌ access_ok=false. Silakan verifikasi kode di landing page.", "err");
        }
      }catch(e){
        setMsg("Gagal cek status: " + e, "err");
      }
    }

    document.getElementById("btnCheck").addEventListener("click", check);

    // Logout harus POST (sesuai app.py kamu)
    document.getElementById("btnLogout").addEventListener("click", async () => {
      setMsg("Logout…");
      try{
        const res = await fetch("/auth/logout", {
          method: "POST",
          credentials: "include"
        });
        const data = await res.json().catch(() => ({}));
        if(res.ok && data.ok){
          window.location.href = "/";
        }else{
          setMsg("Logout gagal: " + (data.error || res.status), "err");
        }
      }catch(e){
        setMsg("Logout error: " + e, "err");
      }
    });

    // auto check saat masuk
    check();
  </script>
</body>
</html>
